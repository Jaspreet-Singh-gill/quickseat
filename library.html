<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Detail - QUICK SEAT</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            color: #333;
        }
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .back-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
            display: inline-flex;
            align-items: center;
        }
        .back-btn:hover {
            background-color: #2980b9;
        }
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            text-align: center;
        }
        .stat-card h3 {
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-card.seats-total .stat-value {
            color: #3498db;
        }
        .stat-card.seats-available .stat-value {
            color: #2ecc71;
        }
        .stat-card.chance .stat-value {
            color: #e74c3c;
        }
        .stat-card.chance .stat-value::after {
            content: '%';
        }
        .chart-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        .chart-container h2 {
            margin-bottom: 15px;
            color: #2c3e50;
        }
        .chart-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .chart-filter-btn {
            background-color: #ecf0f1;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .chart-filter-btn.active {
            background-color: #3498db;
            color: white;
        }
        canvas {
            width: 100% !important;
            height: 400px !important;
        }
        .status-badges {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .status-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        .high-rush {
            background-color: #e74c3c;
            color: white;
        }
        .moderate-rush {
            background-color: #f39c12;
            color: white;
        }
        .low-rush {
            background-color: #2ecc71;
            color: white;
        }

        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            .chart-filters {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1 id="libraryName">Library Name</h1>
    </header>

    <div class="container">
        <button class="back-btn" onclick="window.location.href='index.html'">
            ‚Üê Back to Libraries
        </button>

        <div class="stats-cards">
            <div class="stat-card seats-total">
                <h3>Total Seats</h3>
                <div class="stat-value" id="totalSeats">0</div>
            </div>
            <div class="stat-card seats-available">
                <h3>Available Seats</h3>
                <div class="stat-value" id="availableSeats">0</div>
            </div>
            <div class="stat-card chance">
                <h3>Chance of Getting a Seat</h3>
                <div class="stat-value" id="seatChance">0</div>
            </div>
        </div>

        <div class="chart-container">
            <h2>Seat Availability Trend</h2>
            <div class="chart-filters">
                <button class="chart-filter-btn active" data-period="day">Today</button>
                <button class="chart-filter-btn" data-period="week">This Week</button>
                <div class="status-badges">
                    <span class="status-badge high-rush">High Rush</span>
                    <span class="status-badge moderate-rush">Moderate Rush</span>
                    <span class="status-badge low-rush">Low Rush</span>
                </div>
            </div>
            <canvas id="seatChart"></canvas>
        </div>
    </div>

    <script>
        // Get library ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const libraryId = parseInt(urlParams.get('id'));
        
        // Sample library data (would be fetched from server in real app)
        const libraries = [
            {
                id: 1,
                name: "Central Library",
                totalSeats: 200,
                availableSeats: 45
            },
            {
                id: 2,
                name: "Science Library",
                totalSeats: 150,
                availableSeats: 12
            },
            {
                id: 3,
                name: "Law Library",
                totalSeats: 100,
                availableSeats: 67
            },
            {
                id: 4,
                name: "Medical Library",
                totalSeats: 80,
                availableSeats: 30
            }
        ];
        
        // Find the current library
        const currentLibrary = libraries.find(lib => lib.id === libraryId) || libraries[0];
        
        // Generate weekly data (past 7 days) based on similar patterns
        function generateWeeklyData(library) {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const today = new Date().getDay();
            const weekData = [];
            
            // For each day of the week
            for (let i = 0; i < 7; i++) {
                const dayIndex = (today - 6 + i + 7) % 7; // Calculate the day index
                const dayData = {
                    day: days[dayIndex],
                    hours: []
                };
                
                // For each hour (9am to 9pm)
                for (let hour = 9; hour <= 21; hour++) {
                    // Generate data with patterns:
                    // - More crowded in afternoons
                    // - More crowded on weekdays than weekends
                    // - Random variations
                    
                    const isWeekend = (dayIndex === 0 || dayIndex === 6);
                    const isPeakHour = (hour >= 13 && hour <= 18);
                    
                    let baseAvailability = library.totalSeats * (isWeekend ? 0.7 : 0.5);
                    
                    if (isPeakHour) {
                        baseAvailability *= 0.6; // 40% busier during peak hours
                    }
                    
                    // Add some randomness
                    const randomFactor = 0.8 + (Math.random() * 0.4); // 0.8 to 1.2
                    const availableSeats = Math.round(baseAvailability * randomFactor);
                    
                    // Ensure it doesn't exceed total seats
                    const finalSeats = Math.min(library.totalSeats, Math.max(0, availableSeats));
                    
                    dayData.hours.push({
                        hour: `${hour}:00`,
                        availableSeats: finalSeats
                    });
                }
                
                weekData.push(dayData);
            }
            
            return weekData;
        }
        
        // Generate hourly data for today
        function generateTodayData(library) {
            const todayData = [];
            const currentHour = new Date().getHours();
            
            // For each hour (9am to 9pm)
            for (let hour = 9; hour <= 21; hour++) {
                // More realistic patterns:
                // - Morning: gradual increase in occupancy
                // - Afternoon: peak rush hours
                // - Evening: gradual decrease
                
                let baseOccupancy;
                if (hour < 12) {
                    // Morning: 30-60% occupied
                    baseOccupancy = 0.3 + ((hour - 9) / 3) * 0.3;
                } else if (hour < 18) {
                    // Afternoon peak: 60-80% occupied
                    baseOccupancy = 0.6 + ((hour - 12) / 6) * 0.2;
                } else {
                    // Evening: 80-40% occupied (decreasing)
                    baseOccupancy = 0.8 - ((hour - 18) / 3) * 0.4;
                }
                
                // Add some randomness
                const randomFactor = 0.9 + (Math.random() * 0.2); // 0.9 to 1.1
                const occupancy = baseOccupancy * randomFactor;
                
                // Calculate available seats
                const availableSeats = Math.round(library.totalSeats * (1 - occupancy));
                
                // If hour is in the future, use current trend with more variability
                if (hour > currentHour) {
                    const extraVariability = (Math.random() * 0.3) - 0.15; // -0.15 to 0.15
                    const adjustedSeats = Math.round(availableSeats * (1 + extraVariability));
                    todayData.push({
                        hour: `${hour}:00`,
                        availableSeats: Math.max(0, Math.min(library.totalSeats, adjustedSeats))
                    });
                } else {
                    // For past hours, use "actual" data
                    todayData.push({
                        hour: `${hour}:00`,
                        availableSeats: Math.max(0, Math.min(library.totalSeats, availableSeats))
                    });
                }
            }
            
            return todayData;
        }
        
        // Initialize chart
        let seatChart;
        function initChart() {
            const ctx = document.getElementById('seatChart').getContext('2d');
            
            const todayData = generateTodayData(currentLibrary);
            
            seatChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: todayData.map(d => d.hour),
                    datasets: [{
                        label: 'Available Seats',
                        data: todayData.map(d => d.availableSeats),
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: currentLibrary.totalSeats,
                            title: {
                                display: true,
                                text: 'Available Seats'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Hour of Day'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const availableSeats = context.raw;
                                    const chance = (availableSeats / currentLibrary.totalSeats) * 100;
                                    return `Chance of seat: ${chance.toFixed(1)}%`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update chart based on selected period
        function updateChart(period) {
            if (!seatChart) return;
            
            let chartData, labels;
            
            if (period === 'day') {
                const todayData = generateTodayData(currentLibrary);
                chartData = todayData.map(d => d.availableSeats);
                labels = todayData.map(d => d.hour);
                
                seatChart.options.scales.x.title.text = 'Hour of Day';
            } else if (period === 'week') {
                const weekData = generateWeeklyData(currentLibrary);
                
                // Get data for a specific hour (e.g., 2pm) across all days
                const hour = 14; // 2 PM
                chartData = weekData.map(day => {
                    const hourData = day.hours.find(h => h.hour === `${hour}:00`);
                    return hourData ? hourData.availableSeats : 0;
                });
                
                labels = weekData.map(d => d.day);
                seatChart.options.scales.x.title.text = 'Day of Week';
            }
            
            seatChart.data.labels = labels;
            seatChart.data.datasets[0].data = chartData;
            seatChart.update();
        }
        
        // Populate library data
        function populateLibraryData() {
            // Set library name
            document.getElementById('libraryName').textContent = currentLibrary.name;
            
            // Set stats
            document.getElementById('totalSeats').textContent = currentLibrary.totalSeats;
            document.getElementById('availableSeats').textContent = currentLibrary.availableSeats;
            
            // Calculate and set chance
            const chance = (currentLibrary.availableSeats / currentLibrary.totalSeats) * 100;
            document.getElementById('seatChance').textContent = chance.toFixed(1);
            
            // Initialize chart
            initChart();
        }
        
        // Handle chart filter clicks
        document.querySelectorAll('.chart-filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                // Update active button
                document.querySelectorAll('.chart-filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                // Update chart
                updateChart(e.target.dataset.period);
            });
        });
        
        // Initialize when page loads
        window.addEventListener('load', populateLibraryData);
        
        // Simulate real-time updates every minute
        setInterval(() => {
            // Simulate slight changes in available seats
            const change = Math.floor(Math.random() * 7) - 3; // -3 to +3
            currentLibrary.availableSeats = Math.max(0, Math.min(currentLibrary.totalSeats, currentLibrary.availableSeats + change));
            
            // Update display
            document.getElementById('availableSeats').textContent = currentLibrary.availableSeats;
            
            // Recalculate chance
            const chance = (currentLibrary.availableSeats / currentLibrary.totalSeats) * 100;
            document.getElementById('seatChance').textContent = chance.toFixed(1);
            
            // Update chart if showing today
            if (document.querySelector('.chart-filter-btn[data-period="day"].active')) {
                updateChart('day');
            }
        }, 60000); // Every minute
    </script>
</body>
</html>